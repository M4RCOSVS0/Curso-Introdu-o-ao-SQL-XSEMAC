IF EXISTS (SELECT * FROM sys.databases WHERE name = 'DB_GESTAO')
BEGIN
	USE master
    DROP DATABASE DB_GESTAO
END
GO
CREATE DATABASE DB_GESTAO
GO
USE DB_GESTAO
GO
CREATE TABLE TB_EMPRESA (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    CNPJ VARCHAR(14) NOT NULL UNIQUE,
    RUA VARCHAR(200),
	BAIRRO VARCHAR(200),
	IDENTIFICADOR VARCHAR(15),
	CIDADE VARCHAR(200),
	ESTADO CHAR(2),
    PRIMEIRO_TELEFONE VARCHAR(15),
	SEGUNDO_TELEFONE VARCHAR(15)
)
GO
CREATE TABLE TB_PROJETO (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_EMPRESA INT NOT NULL,
    NOME VARCHAR(100) NOT NULL,
    DESCRICAO VARCHAR(250) NOT NULL,
    DT_INICIO DATE NOT NULL,
    DT_FIM DATE,
    CUSTO_ESTIMADO DECIMAL(10, 2) NOT NULL,
	CUSTO_TOTAL DECIMAL(10, 2),
    STATUS CHAR(1) DEFAULT('A') CHECK (STATUS IN ('A', 'F')), -- A - EM ANDAMENTO | F - FINALIZADO
    FOREIGN KEY (ID_EMPRESA) REFERENCES TB_EMPRESA(ID)
)
GO
CREATE TABLE TB_FUNCIONARIO (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    ID_EMPRESA INT NOT NULL,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) UNIQUE,
    PRIMEIRO_TELEFONE VARCHAR(15),
	SEGUNDO_TELEFONE VARCHAR(15),
    CARGO VARCHAR(50),
    SALARIO DECIMAL(10, 2),
    DT_ADMISSAO DATE NOT NULL,
	DT_DEMISSAO DATE NULL,
	STATUS CHAR(1) DEFAULT('A') CHECK (STATUS IN ('A', 'I')),  -- A - ATIVO | I - INATIVO
    FOREIGN KEY (ID_EMPRESA) REFERENCES TB_EMPRESA(ID)
)
GO
CREATE TABLE TB_FUNCIONARIO_PROJETO (
    ID_FUNCIONARIO INT,
    ID_PROJETO INT,
	DT_INI DATETIME NOT NULL,
	DT_FIM DATETIME,
    PRIMARY KEY (ID_FUNCIONARIO, ID_PROJETO),
    FOREIGN KEY (ID_FUNCIONARIO) REFERENCES TB_FUNCIONARIO(ID),
    FOREIGN KEY (ID_PROJETO) REFERENCES TB_PROJETO(ID),
	CONSTRAINT CHK_DT_FIM CHECK (DT_FIM >= DT_INI OR DT_FIM IS NULL)
)
GO
INSERT INTO TB_EMPRESA (NOME, CNPJ, RUA, BAIRRO, IDENTIFICADOR, CIDADE, ESTADO, PRIMEIRO_TELEFONE, SEGUNDO_TELEFONE)
VALUES 
	('NENGUELTDA', '12345678000195', 'Rua dos Cactos', 'Centro', '15', 'ITABAIANA', 'SE', '79998975609', NULL),
	('TECHSOLUTION', '98765432000100', 'Avenida Principal', 'Industrial', '202', 'ARACAJU', 'SE', '79991234567', '79997654321'),
    ('CONSTRUCTA', '11223344000155', 'Rua da Construção', 'Bela Vista', '45', 'NOSSA SENHORA DO SOCORRO', 'SE', '79991112233', NULL),
    ('GREENFARMS', '33445566000122', 'Estrada Velha', 'Zona Rural', '101', 'SÃO CRISTÓVÃO', 'RJ', '21994332211', NULL);
GO
INSERT INTO TB_PROJETO (ID_EMPRESA, NOME, DESCRICAO, DT_INICIO, DT_FIM, CUSTO_ESTIMADO, CUSTO_TOTAL, STATUS)
VALUES
	(1, 'Sistema de Automação', 'Desenvolvimento de sistema para automação de tarefas diárias', '2024-01-01', '2024-03-31', 50000.00, 48000.00, 'F'),
	(1, 'API de Pagamentos', 'Criação de API para processamento de pagamentos online', '2024-02-01', '2024-04-30', 70000.00, 69000.00, 'F'),
	(1, 'Plataforma de DevOps', 'Plataforma para automação de pipelines de CI/CD', '2024-03-01', '2024-05-31', 80000.00, 78000.00, 'F'),
	(1, 'App de Notificações', 'Aplicativo para envio de notificações push', '2024-04-01', '2024-06-30', 60000.00, 59000.00, 'F'),
	(1, 'Sistema de Login', 'Desenvolvimento de sistema de autenticação e autorização', '2024-05-01', NULL, 55000.00, NULL, 'A'),
	(1, 'Chatbot Inteligente', 'Desenvolvimento de chatbot para suporte ao cliente', '2024-06-01', NULL, 40000.00, NULL, 'A'),
	(1, 'Sistema de Banco de Dados', 'Criação de sistema de gerenciamento de banco de dados', '2024-07-01', '2024-09-30', 75000.00, 74000.00, 'F'),
	(1, 'Web Scraping', 'Sistema para extração de dados da web em tempo real', '2024-08-01', '2024-10-31', 60000.00, 59000.00, 'F'),
	(1, 'Plataforma de eCommerce', 'Desenvolvimento de plataforma de e-commerce com integração de pagamento', '2024-09-01', '2024-11-30', 120000.00, 115000.00, 'F')
GO
INSERT INTO TB_FUNCIONARIO (ID_EMPRESA, NOME, EMAIL, PRIMEIRO_TELEFONE, SEGUNDO_TELEFONE, CARGO, SALARIO, DT_ADMISSAO, DT_DEMISSAO, STATUS)
VALUES
	(1, 'João Silva', 'joao.silva@empresa.com', '999999999', '988888888', 'Gerente de TI', 8000.00, '2024-01-10', NULL, 'A'),
	(1, 'Maria Oliveira', 'maria.oliveira@empresa.com', '977770777', '966666666', 'Desenvolvedora', 6000.00, '2024-02-15', NULL, 'A'),
	(1, 'Carlos Souza', 'carlos.souza@empresa.com', '955555555', '944444444', 'Analista de Marketing', 5000.00, '2024-03-20', NULL, 'A'),
	(1, 'Patrícia Lima', 'patricia.lima@empresa.com', '933333333', '922222222', 'Assistente Administrativo', 3500.00, '2024-04-25', NULL, 'A'),
	(1, 'Lucas Almeida', 'lucas.almeida@empresa.com', '911111111', '900000000', 'Designer', 4500.00, '2024-05-30', NULL, 'A'),
	(1, 'Juliana Costa', 'juliana.costa@empresa.com', '988877777', '977766666', 'Recursos Humanos', 4700.00, '2024-06-15', NULL, 'A'),
	(1, 'Eduardo Pereira', 'eduardo.pereira@empresa.com', '966655555', '955544444', 'Gerente de Vendas', 9500.00, '2024-07-10', NULL, 'A'),
	(1, 'Ana Santos', 'ana.santos@empresa.com', '944433333', '933322222', 'Engenheira de Software', 7000.00, '2024-08-01', NULL, 'A'),
	(1, 'Felipe Rocha', 'felipe.rocha@empresa.com', '922211111', '911100000', 'Analista de Suporte', 4000.00, '2024-09-05', NULL, 'A'),
	(1, 'Fernanda Lima', 'fernanda.souza@empresa.com', '900088888', '899977777', 'Coordenadora de Projetos', 8500.00, '2024-10-12', NULL, 'A')
GO
INSERT INTO TB_FUNCIONARIO_PROJETO (ID_FUNCIONARIO, ID_PROJETO, DT_INI, DT_FIM)
VALUES
    (1, 1, '2024-01-10 08:00:00', '2024-03-31 18:00:00'),
    (2, 2, '2024-02-15 09:00:00', '2024-04-30 18:00:00'),
    (3, 3, '2024-03-20 08:30:00', '2024-05-31 17:30:00'),
    (4, 4, '2024-04-25 09:00:00', '2024-06-30 18:00:00'),
    (5, 5, '2024-05-30 08:00:00', NULL),
    (6, 6, '2024-06-15 09:00:00', NULL),
    (7, 7, '2024-07-10 08:00:00', '2024-09-30 18:00:00'),
    (8, 8, '2024-08-01 08:30:00', '2024-10-31 17:30:00'),
    (9, 9, '2024-09-05 09:00:00', NULL),
	(10, 9, '2024-09-06 10:00:00', NULL),
	(2, 9, '2024-09-06 10:00:00', NULL),
	(3, 9, '2024-09-06 10:00:00', NULL)
GO
PRINT ''
PRINT '----------------------------------------'
PRINT 'BANCO PRONTO PARA PRÁTICA, BONS ESTUDOS!'
PRINT '----------------------------------------'

-- ELABORE AS SEGUINTES CONSULTAS:

-- A) TODAS AS COLUNAS DE TODAS EMPRESAS CADASTRADAS.
-- B) OS ESTADOS DOS REGISTROS ÚNICOS DAS EMPRESAS CADASTRADAS.
-- C) OS NOMES E DT_INICIO DE TODOS OS PROJETOS EM ANDAMENTO.
-- D) TODAS AS COLUNAS DAS EMPRESAS QUE ESTÃO LOCALIZADAS NO ESTADO DE SE E NA CIDADE DE ITABAIANA,
-- OU POSSUEM ALGUM TELEFONE INICIADO EM '79'.
-- E) OS NOMES E DT_INICIO DE TODOS OS PROJETOS QUE INICIARAM EM ('2024-01-01', '2024-04-01', '2024-08-01').
-- F) OS NOMES E O CUSTO ESTIMADO DE TODOS OS PROJETOS QUE TIVERAM UM CUSTO_ESTIMADO ENTRE 70.000 E 100.000 INCLUSIVE.
-- G) TODOS NOMES DE TODOS OS FUNCIONÁRIOS DE TODAS AS EMPRESAS QUE INICIAM COM A LETRA 'F'.
-- H) TODOS NOMES E SALÁRIO DE TODOS OS FUNCIONÁRIOS DE TODAS AS EMPRESAS COM STATUS ATIVO E ORDENADOS POR SALÁRIO EM 
-- ORDEM DECRESCENTE.
-- I) TODOS OS NOMES, CARGOS E EMAIL DOS PRIMEIROS FUNCIONÁRIOS CONTRATADOS POR QUALQUER EMPRESA NO ANO DE 2024.
